#!/sbin/sh

OUTFD=$2
ZIP=$3

ui_print() {
  echo -n -e "ui_print $1\n" > /proc/self/fd/$OUTFD
  echo -n -e "ui_print\n" > /proc/self/fd/$OUTFD
}

cd /tmp
rm -rf tmpdir
mkdir tmpdir
cd tmpdir
unzip -o "$ZIP"

zipdir=/tmp/tmpdir

ui_print 'GENERATED BY universal-debloat-script-generator'
ui_print 'AUTHOR : @ghazzor (github)'
ui_print ' '
ui_print 'WARNING: This script will remove packages from your device.'
ui_print '         I am not responsible for bricked devices.'
ui_print '         Ensure you have backed up your data.'
ui_print ' '

# mount stuff
mount /system_root
mount /product
mount /prism

mount -o rw,remount -t auto /system_root
mount -o rw,remount -t auto /product
mount -o rw,remount -t auto /prism

# source the package list
. $zipdir/nuke_twrp.sh

# Remove bloat if it exists
for bloat in "${packages_to_nuke[@]}"; do
    if [ -e "$bloat" ]; then
        rm -rf "$bloat"
        ui_print "Removed $bloat"
    else
        ui_print "Skipping $bloat (NOT FOUND)"
    fi
done
